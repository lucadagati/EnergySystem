{"version":3,"sources":["./src/app/bldetail/bldetail.page.html","./src/app/bldetail/bldetail.page.scss","./src/app/bldetail/bldetail-routing.module.ts","./src/app/bldetail/bldetail.page.ts","./src/app/bldetail/bldetail.module.ts"],"names":[],"mappings":"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","file":"bldetail-bldetail-module.js","sourcesContent":["export default \"<ion-header>\\n  <ion-toolbar>\\n    <ion-title>\\n      Select your service\\n    </ion-title>\\n  </ion-toolbar>\\n</ion-header>\\n<ion-content>\\n  <div padding>\\n    <ion-button color=\\\"primary\\\" (click)=\\\"getservices()\\\">Get Services on Board</ion-button>\\n  </div>\\n  <ion-card>\\n    <ion-list>\\n      <button ion-item *ngFor=\\\"let value of services\\\" (click)=\\\"connect(value)\\\">\\n      <h2> {{value.name || 'Unnamed'}}</h2>\\n      <p>Service uuid: {{value.uuid}}</p>\\n      <p>DataType: {{value.datatype}}</p>\\n      <p>Tx uuid: {{value.characteristic}}</p>\\n      </button>\\n    </ion-list>\\n  </ion-card>\\n</ion-content>\\n\\n  <ion-content>\\n    <ion-list>\\n      <ion-item *ngFor=\\\"let item of items\\\">{{item}}</ion-item>\\n    </ion-list>\\n    <ion-infinite-scroll threshold=\\\"200px\\\" (ionInfinite)=\\\"loadData($event)\\\">\\n      <ion-infinite-scroll-content\\n        loadingSpinner=\\\"bubbles\\\"\\n        loadingText=\\\"Loading more data...\\\">\\n      </ion-infinite-scroll-content>\\n    </ion-infinite-scroll>\\n</ion-content>\\n\";","export default \"\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsImZpbGUiOiJibGRldGFpbC5wYWdlLnNjc3MifQ== */\";","import { NgModule } from '@angular/core';\nimport { Routes, RouterModule } from '@angular/router';\n\nimport { BldetailPage } from './bldetail.page';\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: BldetailPage\n  }\n];\n\n@NgModule({\n  imports: [RouterModule.forChild(routes)],\n  exports: [RouterModule],\n})\nexport class BldetailPageRoutingModule {}\n","import { Component, NgZone, OnInit, ViewChild } from '@angular/core';\nimport { IonInfiniteScroll, ToastController } from '@ionic/angular';\nimport { ActivatedRoute, Router } from '@angular/router';\nimport { BLE } from '@ionic-native/ble/ngx';\n\n@Component({\n  selector: 'app-bldetail',\n  templateUrl: './bldetail.page.html',\n  styleUrls: ['./bldetail.page.scss'],\n})\nexport class BldetailPage implements OnInit {\n\n  device : any;\n  items = [];\n  services = [];\n  peripheral: any = {};\n  statusMessage: string;\n  service: any = {};\n\n  service_uuid = \"b756d7e1-8f69-4de4-bbfa-a200deef3c0a\";\n  Characteristic_uuid = \"b756d7e2-8f69-4de4-bbfa-a200deef3c0a\";\n  Universal_RX_uuid = \"b756d7e7-8f69-4de4-bbfa-a200deef3c0a\";\n\n\n  obj: any;\n  \n\n  constructor(\n    private ble: BLE,\n    public toastCtrl: ToastController,\n    private ngZone: NgZone,\n    private route: ActivatedRoute, \n    private router: Router) {\n      this.route.queryParams.subscribe(() => {\n        if (this.router.getCurrentNavigation().extras.state) {\n          this.device = this.router.getCurrentNavigation().extras.state.id;\n        }\n        console.log(\"DATA GET: \" + this.device);\n        //this.connect(this.device);        \n      });\n    }\n\n  ngOnInit() {}\n\n  loadData(event){\n    setTimeout(()=> {\n      console.log('Data Loaded');\n      event.target.complete();\n    },500);\n  }\n\n  getservices(){\n    this.ble.connect(this.device).subscribe(\n      peripheral => {\n        this.peripheral=peripheral;\n          this.ble.write(this.device, this.service_uuid, this.Universal_RX_uuid, this.stringToBytes(\"list\"));\n          this.ble.startNotification(this.device, this.service_uuid, this.Characteristic_uuid).subscribe\n            (buffer => {\n                this.obj = JSON.parse(this.uintToString(buffer));\n                this.ble.stopNotification(this.device, this.service_uuid, this.Characteristic_uuid);\n              console.log(\"this.uintToString(buffer)\" + this.obj);\n              console.log(\"service Name List(before for): \"+ JSON.stringify(this.obj.service[0]));\n              console.log(\"service Name List(before for): \"+ JSON.stringify(this.obj.service[1]));\n              console.log(\"service Name List(before for): \"+ (this.obj.service[0].uuid));\n              console.log(\"service Name List(before for): \"+ JSON.stringify((this.obj.service[0].uuid)));\n              /*for (let value of this.obj.service) { \n                this.services.push({name:(value.name), uuid:(value.uuid), \n                  datatype:(value.datatype), characteristic:(value.TXcharacteristic)});\n              }*/\n             var isinside=false\n            for (let value of this.obj.service) { \n              console.log(\"primo for value\"+value );\n              for (let item of this.services){\n                console.log(\"INSIDE DOUBLE FOR\");\n                if (JSON.stringify(item.uuid)==JSON.stringify(value.uuid)){\n                  console.log(\"Already in array\");\n                  isinside = true;\n                }          \n              }\n              if (isinside==false){\n                this.services.push({name:(value.name), uuid:(value.uuid), \n                  datatype:(value.datatype), characteristic:(value.TXcharacteristic)});\n              }\n              else \n                isinside = false;\n            }\n            for (let value of this.services){\n              console.log(value.name);\n              console.log(\"final array \"+ JSON.stringify(value.name));\n            }\n          })\n        },\n      peripheral => this.onDeviceDisconnected(peripheral)\n    );\n    this.ble.disconnect(this.device.id);\n  }\n\n  ////////////////////////////////////////////////////////////// connecting\n  \n  \n  connect(device: any){\n    console.log(\"connect function to \" + this.device);\n    this.ble.connect(this.device).subscribe(\n      peripheral => {\n        this.peripheral=peripheral;\n        this.ngZone.run(() => {\n          console.log(\"before ble activities\");\n          console.log(\"this device\");\n          console.log(this.device);\n          console.log(\"passed device uuid\");\n          console.log(device.uuid);\n          console.log(\"passed device name\");\n          console.log(device.name);\n          console.log(\"passed device characteristic\");\n          console.log(device.characteristic);\n\n            this.ble.write(this.device, device.uuid, this.Universal_RX_uuid, this.stringToBytes(device.name));\n            this.ble.startNotification(this.device, device.uuid, device.characteristic).subscribe\n              (buffer => {\n                console.log(\"inside buffer\");\n                console.log(\"this.uintToString(buffer)\" + this.uintToString(buffer));\n                this.items.push(this.uintToString(buffer));\n              })   \n        })\n      },\n      peripheral => this.onDeviceDisconnected(peripheral)\n    );\n  }\n\n    \n  async onDeviceDisconnected(peripheral: any) {\n    let toast = await this.toastCtrl.create({\n      message: 'The peripheral unexpectedly disconnected',\n      duration: 3000,\n      position: 'middle'\n    });\n    toast.present();\n  }\n\n  ionViewWillLeave() {\n    console.log('ionViewWillLeave disconnecting Bluetooth');\n    this.ble.disconnect(this.peripheral.id).then(\n      () => console.log('Disconnected'),\n      () => console.log('ERROR disconnecting')\n      )\n  }\n\n  setStatus(message: string) {\n    console.log(message);\n    this.ngZone.run(() => {\n      this.statusMessage = message;\n    });\n  }\n    \n    ////////////////////////////////////////////////////  decoding array buffer of notification\n  uintToString(buffer) {\n    var data = new Uint8Array(buffer[0]);\n    return String.fromCharCode.apply(null, data);\n  }\n  \n  stringToBytes(string) {\n    var array = new Uint8Array(string.length);\n    for (var i = 0, l = string.length; i < l; i++) {\n        array[i] = string.charCodeAt(i);\n    }\n    return array.buffer;\n  }\n\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\n\nimport { IonicModule } from '@ionic/angular';\n\nimport { BldetailPageRoutingModule } from './bldetail-routing.module';\n\nimport { BldetailPage } from './bldetail.page';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    IonicModule,\n    BldetailPageRoutingModule\n  ],\n  declarations: [BldetailPage]\n})\nexport class BldetailPageModule {}\n"],"sourceRoot":"webpack:///"}